#!/usr/bin/env bash
set -euo pipefail

# Toujours exécuter depuis la racine du repo
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"
cd "$REPO_ROOT"

# Astuces d'affichage
clear
echo "Monorepo CLI"
echo "============"
echo

while true; do
  echo "Sélection du projet:"
  PS3="Projet \#> "
  target=""
  select opt in "front" "api" "Quitter"; do
    case "$REPLY" in
      1) target="front"; break ;;
      2) target="api"; break ;;
      3) exit 0 ;;
      *) echo "Choix invalide." ;;
    esac
  done

  while true; do
    echo
    echo "Actions pour '$target':"
    PS3="Action \#> "
    select action in "up (lancer le serveur)" "Retour" "Quitter"; do
      case "$REPLY" in
        1)
          echo
          echo "Démarrage du serveur '$target'..."
          echo "---------------------------------"
          # Nécessite un script 'start' dans le package du workspace
          npm run start --workspace="$target"
          echo
          echo "Processus terminé pour '$target'."
          ;;
        2) break 2 ;;  # Retour à la sélection du projet
        3) exit 0 ;;
        *) echo "Choix invalide." ;;
      esac
    done
  done
done
